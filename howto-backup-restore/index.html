



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>How to Backup and Restore a BBL Environment using BBR - BBL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#how-to-backup-and-restore-a-bbl-environment-using-bbr" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="BBL" class="md-header-nav__button md-logo">
          
            <img src="../theme/bosh.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              BBL
            </span>
            <span class="md-header-nav__topic">
              
                How to Backup and Restore a BBL Environment using BBR
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="BBL" class="md-nav__button md-logo">
      
        <img src="../theme/bosh.svg" width="48" height="48">
      
    </a>
    BBL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="BOSH Bootloader" class="md-nav__link">
      BOSH Bootloader
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced-configuration/" title="Advanced configuration" class="md-nav__link">
      Advanced configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cf-lbs/" title="Cloud Foundry Load Balancers" class="md-nav__link">
      Cloud Foundry Load Balancers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cleaning-up/" title="Cleaning Up" class="md-nav__link">
      Cleaning Up
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloudfoundry/" title="Generic Steps for Cloud Foundry Deployment" class="md-nav__link">
      Generic Steps for Cloud Foundry Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concourse/" title="Concourse" class="md-nav__link">
      Concourse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../credhub/" title="Accessing the BOSH Director CredHub" class="md-nav__link">
      Accessing the BOSH Director CredHub
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../customization/" title="Customizing your infrastructure and director" class="md-nav__link">
      Customizing your infrastructure and director
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-aws/" title="Getting Started: AWS" class="md-nav__link">
      Getting Started: AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-azure/" title="Getting Started: Microsoft Azure" class="md-nav__link">
      Getting Started: Microsoft Azure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-gcp/" title="Getting Started: GCP" class="md-nav__link">
      Getting Started: GCP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-openstack/" title="Getting Started: OpenStack" class="md-nav__link">
      Getting Started: OpenStack
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-vsphere/" title="Getting Started: vSphere" class="md-nav__link">
      Getting Started: vSphere
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How to Backup and Restore a BBL Environment using BBR
      </label>
    
    <a href="./" title="How to Backup and Restore a BBL Environment using BBR" class="md-nav__link md-nav__link--active">
      How to Backup and Restore a BBL Environment using BBR
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#enable-backup-and-restore-on-your-bbl-director" class="md-nav__link">
    Enable Backup and Restore on your BBL Director
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-your-bbl-environment" class="md-nav__link">
    Accessing your BBL Environment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh-onto-the-jumpbox" class="md-nav__link">
    SSH onto the Jumpbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-bosh_all_proxy" class="md-nav__link">
    Use BOSH_ALL_PROXY
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-director-backup" class="md-nav__link">
    BBR Director Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-deployment-backup" class="md-nav__link">
    BBR Deployment Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-restore" class="md-nav__link">
    BBR Restore
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-ssh/" title="How To SSH" class="md-nav__link">
      How To SSH
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-target-bosh-director/" title="How To Target The BOSH Director" class="md-nav__link">
      How To Target The BOSH Director
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known-issues/" title="Known issues" class="md-nav__link">
      Known issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-19-1" type="checkbox" id="nav-19-1">
    
    <label class="md-nav__link" for="nav-19-1">
      Decisions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-19-1">
        Decisions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0001-record-architecture-decisions/" title="1. Record architecture decisions" class="md-nav__link">
      1. Record architecture decisions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0002-replace-go-bindata-with-packr2/" title="2. Replace go-bindata with packr2" class="md-nav__link">
      2. Replace go-bindata with packr2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#enable-backup-and-restore-on-your-bbl-director" class="md-nav__link">
    Enable Backup and Restore on your BBL Director
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-your-bbl-environment" class="md-nav__link">
    Accessing your BBL Environment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh-onto-the-jumpbox" class="md-nav__link">
    SSH onto the Jumpbox
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-bosh_all_proxy" class="md-nav__link">
    Use BOSH_ALL_PROXY
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-director-backup" class="md-nav__link">
    BBR Director Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-deployment-backup" class="md-nav__link">
    BBR Deployment Backup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bbr-restore" class="md-nav__link">
    BBR Restore
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="how-to-backup-and-restore-a-bbl-environment-using-bbr">How to Backup and Restore a BBL Environment using BBR</h1>
<p><a href="https://github.com/cloudfoundry-incubator/bosh-backup-and-restore">BBR</a> can be used to backup and restore your BOSH Director or its deployments.  It uses the BOSH cli to target the Director and SSH onto the Director and deployment VMs. Documentation for the backup and restore a generic BOSH environment can be found <a href="https://docs.cloudfoundry.org/bbr/index.html">here</a>.</p>
<h2 id="enable-backup-and-restore-on-your-bbl-director">Enable Backup and Restore on your BBL Director</h2>
<p>Backup and restore is not enabled by default in a bbl'd up director.
To enable it, you must apply the <code>bbr.yml</code> ops file that is present in the top-level of the <a href="https://github.com/cloudfoundry/bosh-deployment/blob/master/bbr.yml"><code>bosh-deployment</code> repo</a>.
To do this, follow the <a href="../customization/#override-scripts">instructions for overriding your director creation script</a> and apply this ops file. </p>
<h2 id="accessing-your-bbl-environment">Accessing your BBL Environment</h2>
<p>To backup or restore your BOSH Director and its deployments you must either SSH onto your BBL jumpbox or use <code>BOSH_ALL_PROXY</code> provided by BBL.</p>
<h3 id="ssh-onto-the-jumpbox">SSH onto the Jumpbox</h3>
<p>SSH onto your BBL jumpbox using the following command:</p>
<pre><code class="bash">$&gt; bbl ssh --jumpbox
</code></pre>

<p>When on the jumpbox, you must get the BBR binary and run all BBR commands on the jumpbox.</p>
<h3 id="use-bosh_all_proxy">Use <code>BOSH_ALL_PROXY</code></h3>
<p>Use the <code>BOSH_ALL_PROXY</code> environment variable provided by BBL:</p>
<pre><code class="bash">$&gt; eval &quot;$(bbl print-env)&quot;
...
BOSH_ALL_PROXY=ssh+socks5://jumpbox@DIRECTOR-IP:22?private-key=path/to/jumpbox/key
</code></pre>

<p>You can now use BBR on your local machine and all requests to the BOSH Director will be forwarded through the jumpbox.</p>
<h2 id="bbr-director-backup">BBR Director Backup</h2>
<p>You can run the BBR director backup command as documented <a href="https://docs.cloudfoundry.org/bbr/backup.html#back-up-director">here</a>.</p>
<p>For BBL, the default configuration is the following:</p>
<pre><code>bbr director \
    --host DIRECTOR-IP \
    --username BBR-USERNAME \
    --private-key-path BOSH-DIRECTOR-PRIVATE-KEY-PATH \
backup
</code></pre>

<p>Where:
- <code>DIRECTOR-IP</code> is internal (or public) IP of your BOSH Director.  This can be obtained using <code>bbl director-address</code> and removing the port.
- <code>BBR-USERNAME</code> is the user that BBR uses to SSH onto the Director VM.  For BBL, this is <code>jumpbox</code>.
- <code>BOSH-DIRECTOR-PRIVATE-KEY-PATH</code> is the path to your BOSH Director's private key.  The contexts of the BOSH Director's key can be obtained using <code>bbl director-ssh-key</code>.</p>
<h2 id="bbr-deployment-backup">BBR Deployment Backup</h2>
<p>You can run the BBR deployment backup command as documented <a href="https://docs.cloudfoundry.org/bbr/backup.html#back-up-deployment">here</a>.  If you have run the BBL command, <code>$&gt; eval "$(bbl print-env)"</code>, then BBR will pick up all BOSH environment variables it needs to back up the deployment.</p>
<p>For BBL, the default configuration is the following:</p>
<pre><code>bbr director \
    --deployment DEPLOYMENT-NAME \
backup
</code></pre>

<p>Where:
- <code>DEPLOYMENT-NAME</code> is the name of the deployment that you want to backup using BBR.</p>
<h2 id="bbr-restore">BBR Restore</h2>
<p>You can run the BBR director or deployment restore commands as documented <a href="https://docs.cloudfoundry.org/bbr/restore.html">here</a>.  These are similar to the BBR backup commands above but with the additional <code>--artifact-path</code> which is a previously taken BBR backup artifact.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting-started-vsphere/" title="Getting Started: vSphere" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started: vSphere
              </span>
            </div>
          </a>
        
        
          <a href="../howto-ssh/" title="How To SSH" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                How To SSH
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>