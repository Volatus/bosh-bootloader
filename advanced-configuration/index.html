



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Advanced configuration - BBL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#advanced-configuration" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="BBL" class="md-header-nav__button md-logo">
          
            <img src="../theme/bosh.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              BBL
            </span>
            <span class="md-header-nav__topic">
              
                Advanced configuration
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="BBL" class="md-nav__button md-logo">
      
        <img src="../theme/bosh.svg" width="48" height="48">
      
    </a>
    BBL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="BOSH Bootloader" class="md-nav__link">
      BOSH Bootloader
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced configuration
      </label>
    
    <a href="./" title="Advanced configuration" class="md-nav__link md-nav__link--active">
      Advanced configuration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-bosh-ops-files" class="md-nav__link">
    About BOSH ops-files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-pre-made-operations-files" class="md-nav__link">
    Using the pre-made operations files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authoring-an-ops-file" class="md-nav__link">
    Authoring an ops-file
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cf-lbs/" title="Cloud Foundry Load Balancers" class="md-nav__link">
      Cloud Foundry Load Balancers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cleaning-up/" title="Cleaning Up" class="md-nav__link">
      Cleaning Up
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloudfoundry/" title="Generic Steps for Cloud Foundry Deployment" class="md-nav__link">
      Generic Steps for Cloud Foundry Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concourse/" title="Concourse" class="md-nav__link">
      Concourse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../credhub/" title="Accessing the BOSH Director CredHub" class="md-nav__link">
      Accessing the BOSH Director CredHub
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../customization/" title="Customizing your infrastructure and director" class="md-nav__link">
      Customizing your infrastructure and director
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-aws/" title="Getting Started: AWS" class="md-nav__link">
      Getting Started: AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-azure/" title="Getting Started: Microsoft Azure" class="md-nav__link">
      Getting Started: Microsoft Azure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-gcp/" title="Getting Started: GCP" class="md-nav__link">
      Getting Started: GCP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-openstack/" title="Getting Started: OpenStack" class="md-nav__link">
      Getting Started: OpenStack
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-vsphere/" title="Getting Started: vSphere" class="md-nav__link">
      Getting Started: vSphere
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-backup-restore/" title="How to Backup and Restore a BBL Environment using BBR" class="md-nav__link">
      How to Backup and Restore a BBL Environment using BBR
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-ssh/" title="How To SSH" class="md-nav__link">
      How To SSH
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-target-bosh-director/" title="How To Target The BOSH Director" class="md-nav__link">
      How To Target The BOSH Director
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known-issues/" title="Known issues" class="md-nav__link">
      Known issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-19-1" type="checkbox" id="nav-19-1">
    
    <label class="md-nav__link" for="nav-19-1">
      Decisions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-19-1">
        Decisions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0001-record-architecture-decisions/" title="1. Record architecture decisions" class="md-nav__link">
      1. Record architecture decisions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0002-replace-go-bindata-with-packr2/" title="2. Replace go-bindata with packr2" class="md-nav__link">
      2. Replace go-bindata with packr2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    Table of Contents
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-bosh-ops-files" class="md-nav__link">
    About BOSH ops-files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-pre-made-operations-files" class="md-nav__link">
    Using the pre-made operations files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authoring-an-ops-file" class="md-nav__link">
    Authoring an ops-file
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="advanced-configuration">Advanced configuration</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href='#opsfile'>Using a BOSH ops-file with bbl</a></li>
<li><a href='#terraform'>Customizing IaaS Paving with Terraform</a></li>
<li><a href='#plan-patches'>Applying and authoring plan patches, bundled modifications to default bbl configurations.</a></li>
</ul>
<h2 id="using-a-bosh-ops-file-with-bbl"><a name='opsfile'></a>Using a BOSH ops-file with bbl</h2>
<h3 id="about-bosh-ops-files">About BOSH ops-files</h3>
<p>Certain features of BOSH, particularly experimental features or tuning parameters, must be enabled by modifying your
Director's deployment manifest. <a href="https://github.com/cloudfoundry/bosh-deployment"><code>bosh-deployment</code></a> contains many such <a href="https://bosh.io/docs/terminology.html#operations-file">ops files</a> for common features and options.</p>
<h3 id="using-the-pre-made-operations-files">Using the pre-made operations files</h3>
<p>You can provide any number of ops files or variables to <code>bosh create-env</code> by creating <code>create-director-override.sh</code>. This file will not be overridden by bbl. You can use <code>create-director.sh</code> as a template, and you can even edit that file instead, but if you do, your changes will be overridden the next time you run <code>bbl plan</code>.</p>
<p>In this example, I use a local version of BOSH director that I have built based off of a branch by referencing an ops file that is included as part of <code>bosh-deployment</code>:</p>
<pre><code class="diff">bosh create-env \
  ${BBL_STATE_DIR}/bosh-deployment/bosh.yml \
  --state  ${BBL_STATE_DIR}/vars/bosh-state.json \
  --vars-store  ${BBL_STATE_DIR}/vars/director-vars-store.yml \
  --vars-file  ${BBL_STATE_DIR}/vars/director-vars-file.yml \
+  -o ${BBL_STATE_DIR}/bosh-deployment/local-bosh-release.yml
+  -v local_bosh_release=${BBL_STATE_DIR}/../../build/bosh-dev.tgz
  -o  ${BBL_STATE_DIR}/bosh-deployment/cpi.yml \
  -o  ${BBL_STATE_DIR}/bosh-deployment/jumpbox-user.yml \
  -o  ${BBL_STATE_DIR}/bosh-deployment/uaa.yml \
  -o  ${BBL_STATE_DIR}/../shared/bosh-deployment/credhub.yml 
</code></pre>

<h3 id="authoring-an-ops-file">Authoring an ops-file</h3>
<p>The <a href="http://bosh.io/docs/cli-ops-files.html">operations files</a> provided by <code>bosh-deployment</code> may not meet your needs. In this case you will have to write your own
custom ops-file. Store it somewhere outside of the bosh-deployment directory. New versions of bbl will keep the
bosh-deployment directory in sync with the latest configuration and releases, so modifications may be lost when
<code>bbl plan</code> is run in the future. Consider storing it in the top level of your state directory if it is environmentally
specific, or above the state directory if it is true for all environments.</p>
<p>Here is an example of adding an ops file that configures a few settings on all of my BOSH directors:  </p>
<pre><code class="diff">#!/bin/sh
bosh create-env \
  ${BBL_STATE_DIR}/bosh-deployment/bosh.yml \
  --state  ${BBL_STATE_DIR}/vars/bosh-state.json \
  --vars-store  ${BBL_STATE_DIR}/vars/director-vars-store.yml \
  --vars-file  ${BBL_STATE_DIR}/vars/director-vars-file.yml \
+  -o ${BBL_STATE_DIR}/../../bbl-envs/shared/increase-workers-threads-and-flush-arp.yml
  -o  ${BBL_STATE_DIR}/bosh-deployment/cpi.yml \
  -o  ${BBL_STATE_DIR}/bosh-deployment/jumpbox-user.yml \
  -o  ${BBL_STATE_DIR}/bosh-deployment/uaa.yml \
  -o  ${BBL_STATE_DIR}/../shared/bosh-deployment/credhub.yml
</code></pre>

<h2 id="customizing-iaas-paving-with-terraform"><a name='terraform'></a>Customizing IaaS Paving with Terraform</h2>
<p>Numerous settings can be reconfigured repeatedly by editing <code>$BBL_STATE_DIR/vars/terraform.tfvars</code> or adding a terraform override into  <code>$BBL_STATE_DIR/terraform/my-cool-template-override.tf</code>. Some settings, like VPCs, are not able to be changed after initial creation so it may be better to <code>bbl plan</code> first before running <code>bbl up</code> for the first time.</p>
<h3 id="example-adjusting-the-cidr-on-aws">Example: adjusting the cidr on AWS</h3>
<ol>
<li>Plan the environment:
    <code>mkdir some-env &amp;&amp; cd some-env
    export BBL_IAAS=aws
    export BBL_AWS_REGION=us-west-1
    export BBL_AWS_ACCESS_KEY_ID=12345678
    export BBL_AWS_SECRET_ACCESS_KEY=12345678
    bbl plan
    echo -e "\nvpc_cidr=\"192.168.0.0/20\"" &gt;&gt; vars/terraform.tfvars</code></li>
<li>Create the environment:
    <code>bbl up</code>
    That's it. Your director is now at <code>192.168.0.6</code>.</li>
</ol>
<h2 id="plan-patches"><a name='plan-patches'> <a href="https://github.com/cloudfoundry/bosh-bootloader/tree/master/plan-patches">Plan Patches</a></h2>
<p>Through operations files and terraform overrides, all sorts of wild modifications can be done to the vanilla bosh environments that bbl creates. The basic principal of a plan patch is to make several modifications to a bbl plan in override files that bbl finds under <code>terraform/</code>, <code>cloud-config/</code>, and <code>{create,delete}-{jumpbox,director}.sh</code> . BBL will read and merge those into it's plan when you run <code>bbl up</code>.</p>
<p>We've used plan patches to <a href="https://github.com/cloudfoundry/bosh-bootloader/tree/master/plan-patches/bosh-lite-gcp">deploy bosh-lite directors on gcp</a>, to deploy CF Isolation Segments on <a href="https://github.com/cloudfoundry/bosh-bootloader/tree/master/plan-patches/iso-segs-gcp">public</a> <a href="https://github.com/cloudfoundry/bosh-bootloader/tree/master/plan-patches/iso-segs-aws">clouds</a>, and to deploy bosh managed k8s clusters with working cloud-providers using <a href="https://github.com/cloudfoundry-incubator/kubo-deployment/tree/master/manifests">cfcr</a>.</p>
<p>Our plan patches are experimental. They were tested a bit when we wrote them, but we don't continuously integrate against their dependencies or even check if they still work with recent versions of terraform. They should be used with caution. Operators should make sure they understand each modification and its implications before using our patches in their own environments. Regardless, the plan-patches in this repo are great examples of the different ways you can configure bbl to deploy whatever you might need. To see all the plan patches, visit the <a href="https://github.com/cloudfoundry/bosh-bootloader/tree/master/plan-patches">Plan Patches README.md</a>. If you write your own plan patch that gets you what you need, please consider upstreaming it in a PR.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="BOSH Bootloader" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                BOSH Bootloader
              </span>
            </div>
          </a>
        
        
          <a href="../cf-lbs/" title="Cloud Foundry Load Balancers" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cloud Foundry Load Balancers
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>