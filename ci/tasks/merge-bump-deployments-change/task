#!/bin/bash -exu

ROOT="${PWD}"

function main() {
  pushd "${ROOT}/bosh-bootloader-bumped" > /dev/null
    git config user.email "cf-infrastructure@pivotal.io"
    git config user.name "cf-infra-bot"
    git remote add http https://github.com/cloudfoundry/bosh-bootloader.git
    git fetch http

    git checkout 8.4.x

    if ! git merge --no-edit bump-deployments-ci-8.4.x ; then
      git checkout --theirs deployment-versions.txt
      git add .
      git commit -m "Merge branch 'bump-deployments-ci-8.4.x'."
    fi

    cp -r . ${ROOT}/bosh-bootloader
  popd > /dev/null
}

main
